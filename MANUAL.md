# 視覚探索実験予約システム - 運用マニュアル

## システム概要
2025年8月8日〜8月31日に実施する視覚探索実験の参加者予約を管理するWebアプリケーションです。

## 機能一覧

### 参加者機能
1. **参加者登録**: 氏名・メールアドレスの登録
2. **予約**: 利用可能な時間枠から希望の時間を選択・予約
3. **予約確認**: 予約完了時に確認メールを受信
4. **リマインダー**: 実験前日12:00にリマインドメールを受信

### 管理者機能
1. **ダッシュボード**: 予約状況の概要確認
2. **時間枠管理**: 各時間枠の公開/非公開切替
3. **予約管理**: 全予約の一覧表示・キャンセル
4. **統計情報**: 総枠数・公開枠数・予約数・参加者数の表示

## 使用方法

### 参加者向け

#### 1. 予約ページアクセス
- 指定されたURLにアクセス（`https://your-domain.com/index.html`）

#### 2. 参加者情報登録
1. 「お名前」を入力（必須）
2. 「メールアドレス」を入力（必須）
3. 「登録する」ボタンをクリック

#### 3. 時間枠選択
1. 利用可能な時間枠一覧が表示される
2. 希望の日時の「選択」ボタンをクリック
3. 予約確認画面で内容を確認
4. 「予約を確定する」ボタンをクリック

#### 4. 予約完了
- 予約完了画面が表示される
- 確認メールが登録メールアドレスに送信される
- 実験前日にリマインダーメールが送信される

### 管理者向け

#### 1. 管理画面アクセス
- 管理画面URL（`https://your-domain.com/admin.html`）にアクセス

#### 2. ログイン
- ユーザー名: `admin`
- パスワード: `admin123`（本番環境では必ず変更）

#### 3. ダッシュボード確認
- 総時間枠数
- 公開中の枠数
- 予約総数
- 参加者総数

#### 4. 時間枠管理
- 各時間枠の公開/非公開をトグルスイッチで切替
- 「詳細」ボタンで時間枠の詳細情報を確認

#### 5. 予約管理
- 全予約の一覧表示
- 予約のキャンセル（「キャンセル」ボタン）

## メール機能

### 予約確認メール
**送信タイミング**: 予約完了直後
**内容**:
- 予約詳細（日時、参加者情報）
- 実験準備事項
- 注意事項
- 連絡先情報

### リマインダーメール
**送信タイミング**: 実験前日の12:00
**内容**:
- 実験詳細の再確認
- Zoomリンク（本番環境で設定）
- 準備チェックリスト
- 緊急連絡先

## システム管理

### 日次運用
1. **予約状況確認**: 管理画面で当日・翌日の予約を確認
2. **時間枠調整**: 必要に応じて時間枠の公開/非公開を調整
3. **リマインダーメール**: 自動送信（12:00）の動作確認

### 週次運用
1. **予約データのバックアップ**
2. **システムログの確認**
3. **メール送信ログの確認**

### 月次運用
1. **データベースの最適化**
2. **セキュリティ更新の確認**
3. **システム性能の確認**

## トラブル対応

### よくある問題と解決方法

#### 予約ができない
**原因**: 時間枠が非公開になっている
**解決**: 管理画面で該当時間枠を公開に設定

#### メールが届かない
**原因**: 
- メールアドレスの入力ミス
- スパムフィルターによる迷惑メール扱い
- SMTPサーバーの問題

**解決**:
1. メールアドレスの確認
2. 迷惑メールフォルダの確認
3. サーバーのメールログ確認

#### 管理画面にログインできない
**原因**: パスワード忘れ
**解決**: データベースでパスワードハッシュを更新

```sql
UPDATE admin_users 
SET password_hash = '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi' 
WHERE username = 'admin';
-- パスワード: admin123
```

#### 予約データが表示されない
**原因**: データベース接続エラー
**解決**: 
1. データベースサーバーの状態確認
2. 接続設定の確認
3. ログファイルの確認

## セキュリティ対策

### 実装済み対策
1. **SQLインジェクション防止**: Prepared Statement使用
2. **XSS防止**: 出力時のエスケープ処理
3. **CSRF防止**: セッション管理
4. **セキュリティヘッダー**: X-Frame-Options等

### 運用時の注意事項
1. **管理者パスワードの定期変更**
2. **アクセスログの監視**
3. **不審なアクセスの検知**
4. **SSL証明書の更新**

## バックアップとリストア

### バックアップ
```bash
# データベースバックアップ
mysqldump -u username -p uvg6yj0ckmhk1mrf > backup_$(date +%Y%m%d).sql

# ファイルバックアップ
tar -czf system_backup_$(date +%Y%m%d).tar.gz /path/to/project/
```

### リストア
```bash
# データベースリストア
mysql -u username -p uvg6yj0ckmhk1mrf < backup_20250808.sql
```

## 緊急時対応

### システム停止時
1. **原因調査**: ログファイルの確認
2. **復旧作業**: サービス再起動・設定修正
3. **連絡**: 実験責任者への報告

### データ消失時
1. **バックアップからの復旧**
2. **データ整合性の確認**
3. **参加者への連絡**（必要に応じて）

## 連絡先
- システム管理者: [管理者メールアドレス]
- 実験責任者: experiment@university.edu
- 緊急時連絡先: 03-1234-5678

## 付録

### データベーススキーマ
- `slots`: 時間枠マスタ
- `participants`: 参加者マスタ  
- `reservations`: 予約データ
- `admin_users`: 管理者ユーザー

### APIエンドポイント
- `GET /api/slots`: 公開時間枠取得
- `POST /api/reservations`: 予約作成
- `PUT /api/slots/{id}/toggle`: 時間枠公開切替
- `PUT /api/reservations/{id}/cancel`: 予約キャンセル